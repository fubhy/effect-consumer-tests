{"version":3,"file":"tReentrantLock.js","names":["Effect","require","Equal","FiberId","Function_js_1","HashMap","Option","core","tRef","TReentrantLockSymbolKey","exports","TReentrantLockTypeId","Symbol","for","WriteLockTypeId","ReadLockTypeId","TReentranLockImpl","state","constructor","ReadLock","readers","readLocks","Array","from","reduce","acc","curr","writeLocks","readLocksHeld","fiberId","getOrElse","get","writeLocksHeld","_fiberId","WriteLock","equals","isReadLock","lock","isWriteLock","emptyReadLock","empty","makeReadLock","count","make","noOtherHolder","readLock","isEmpty","size","has","adjustReadLock","adjustment","total","newTotal","Error","remove","set","adjustRead","self","delta","withSTMRuntime","runtime","unsafeGet","journal","result","unsafeSet","succeed","threadName","retry","acquireRead","acquireWrite","fiberReadLocks","effect","fiberWriteLocks","writeLock","locked","zipWith","readLocked","writeLocked","x","y","map","acquireRelease","commit","releaseRead","releaseWrite","withLock","dual","withWriteLock","withReadLock","uninterruptibleMask","restore","zipRight","ensuring"],"sources":["../../../../src/internal/stm/tReentrantLock.ts"],"sourcesContent":[null],"mappings":"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"}